<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>The Druid's Handbook</title>
		<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
		<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" type="text/css" href="handbook.css">
		<script src="js/jquery-1.11.3.min.js"></script>
		<script src="js/isotope.pkgd.min.js"></script>
		<script src="js/mustache.js"></script>
        <script src="js/common.js"></script>
		<script src="js/handbook.js"></script>
		<script src="js/sql.js"></script>

		<script id="section_template" type="x-tmpl-mustache">
			<div id="{{id}}" class="section {{class}}">
				<div class="sizer"></div>
				<div class="gutter"></div>
			</div>	
		</script>

		<script id="default_template" type="x-tmpl-mustache">
			<div id="{{selector}}" class="tile {{class}}" data-rating="0">
				<h2>{{name}}</h2>
				<h4 class="navy black blue red">
				<span class="rating" onclick="saveRating('{{selector}}',this,event)"></span>
				<span>{{name}}</span>
				<span class="score"></span>
				</h4>
				<div class="icon">
					<div class="book"></div>
					<div class="beast"></div>
					<div class="summoner"></div>
					<div class="master"></div>
				</div>
				<div class="desc">
				<p>{{{desc}}}</p>
				</div>
			</div>
		</script>

		<script>
			function format_page() {

                Handbook.ajax({
                    "action": "count",
                    "jsonp": "getRating"
                });

                var $rest = $('.section.third');

                $rest.isotope({
					itemSelector: '.tile',
					percentPosition: true,
					masonry: {
						columnWidth: '.sizer',
						gutter: '.gutter'
					},
					sortAscending: false,
					getSortData: {
						rating: Handbook.utils.rating,
						color:  Handbook.utils.color
					}
				});

				$rest.isotope({
					sortBy: [ 'color', 'rating' ]
				});

                setup();
			}

			$(function() {
				Handbook.init({
					"db"      : "druid.db",
					"query"   : [
						["select * from section where id <> 'animal'", undefined,   "#section_template", "#handbook"],
						["select * from guide",   format_item],
						["select * from feat",    format_item],
						["select * from skill",   format_item]
					],
					"callback" : format_page
				})
			})
		</script>
	</head>

	<body>
		<div id="handbook">
            <div class="menu">
                <div class="link"><a href="index.html">Introduction</a></div>
                <div class="link"><a href="animal.html">Wild Shape Forms</a></div>
                <div class="link"><a href="#">Animal Companions</a></div>
                <div class="link"><a href="#">Spellcasting</a></div>
				<div class="link"><a href="changelog.html">Changelog</a></div>
            </div>
		</div>
    </body>
</html>